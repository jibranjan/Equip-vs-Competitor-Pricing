<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="icon" href="https://cdn.equip.co/static/img/favicon.png" />
    <script src="https://cdn.tailwindcss.com"></script>
    <title>Pricing | Equip</title>
  </head>

  <body>
    <script>
      var fetchedData;
      let p = fetch(
        "https://tvw82n52.api.sanity.io/v2022-03-07/data/query/production?query=*%5B_type+%3D%3D+%22competitorPricing%22%5D"
      );
      p.then((response) => {
        return response.json();
      }).then((value) => {
        fetchedData = value;
        console.log(value);
        addInDropdown();
      });

      function addInDropdown() {
        let dropdownEl = document.getElementById("competitors");

        fetchedData.result.forEach(function (index) {
          if (index.label === "equip") {
            return;
          }
          let option = document.createElement("option");
          option.value = index.label;
          option.textContent = index.name;
          dropdownEl.appendChild(option);
        });
      }

      function getCompetitor() {
        let CompetitorsEl = document.getElementById("competitors");
        let selectedIndex = CompetitorsEl.selectedIndex;
        let selectedCompetitor = CompetitorsEl.options[selectedIndex];
        let competitorValue = selectedCompetitor.value;
        return competitorValue;
      }

      function getCountry() {
        let countriesEl = document.getElementById("countries");
        let selectedIndex = countriesEl.selectedIndex;
        let selectedCountry = countriesEl.options[selectedIndex];
        let countryValue = selectedCountry.value;
        return countryValue;
      }

      function getValue() {
        let noOfCandidatesEl = document.getElementById("no-of-candidates");
        return noOfCandidatesEl.value;
      }

      function validationOfInput(event) {
        let key = event.key;
        if (getValue() === "" && event.key === "0") {
          event.preventDefault();
        }
        if (key === "-" || key === "+" || key === ".") {
          event.preventDefault();
        }
        if (key === "Enter") {
          event.preventDefault();
          onSubmit();
        }
        if (event.type === "paste") {
          let pasteData = event.clipboardData.getData("text/plain");
          if (!/^\d+$/.test(pasteData) || pasteData.startsWith("0")) {
            event.preventDefault();
          }
        }
      }
      function getPricingModel() {
        let pricingModel;
        fetchedData.result.forEach(function (index) {
          if (index.label === getCompetitor()) {
            pricingModel = index.parameters.pricingModel;
          }
        });
        return pricingModel;
      }

      function getCost() {
        let cost;
        let pricingModel = getPricingModel();

        fetchedData.result.forEach(function (index) {
          if (index.label === getCompetitor()) {
            if (pricingModel === "pure-usage") {
              cost = index.parameters.costPerCandidate;
            } else if (pricingModel === "pure-subscription") {
              cost = index.parameters.annualSubscriptionCost;
            } else if (pricingModel === "subscription-with-usage") {
              cost = {
                perCandidate: index.parameters.costPerCandidate,
                annual: index.parameters.annualSubscriptionCost,
              };
            }
          }
        });
        console.log(cost);
        return cost;
      }

      function calculateCompetitorCost() {
        let noOfCandidates = getValue();
        let competitorOutputEl = document.getElementById("output-competitor");
        let pricingModel = getPricingModel();
        if (pricingModel === "pure-usage") {
          if (getCountry() === "IN") {
            competitorOutputEl.innerHTML = "₹" + noOfCandidates * getCost().IN;
          } else if (getCountry() === "US") {
            let usCost = noOfCandidates * getCost().US;
            competitorOutputEl.innerHTML = "$" + usCost.toFixed(2);
          }
        } else if (pricingModel === "pure-subscription") {
          if (getCountry() === "IN") {
            competitorOutputEl.innerHTML = "₹" + noOfCandidates * getCost().IN;
          } else if (getCountry() === "US") {
            let usCost = noOfCandidates * getCost().US;
            competitorOutputEl.innerHTML = "$" + usCost.toFixed(2);
          }
        } else if (pricingModel === "subscription-with-usage") {
        }
      }

      function calculateEquipCost() {
        let noOfCandidates = getValue();
        let equipOutputEl = document.getElementById("output-equip");
        if (getCountry() === "IN") {
          equipOutputEl.innerHTML = "₹" + noOfCandidates * 82;
        } else if (getCountry() === "US") {
          let usCost = noOfCandidates * 0.99;
          equipOutputEl.innerHTML = "$" + usCost.toFixed(2);
        }
      }

      function onSubmit() {
        calculateCompetitorCost();
        calculateEquipCost();
      }
    </script>
    <div
      class="flex flex-col gap-10 text-xl rounded-md border-2 border-blue-900 max-w-xl mx-auto mt-40 p-2"
    >
      <div>
        <span>Competitor:</span>
        <select name="Competitors" id="competitors"></select>
      </div>
      <div>
        <span>Country:</span>
        <select id="countries" onchange="getCountry()">
          <option class="country" value="IN" selected="true">India</option>
          <option class="country" value="US">US</option>
        </select>
      </div>
      <div class="">
        <label class="" for="no-of-candidates">No. Of Candidates:</label>
        <input
          id="no-of-candidates"
          class="rounded-md border-2 border-emerald-500"
          type="number"
          onpaste="validationOfInput(event)"
          onkeydown="validationOfInput(event)"
        />
      </div>
      <div class="flex gap-10">
        <div>
          <span class="inline-block mb-1">Equip:</span>
          <div
            id="output-equip"
            class="border-2 border-emerald-500 min-w-20 h-8 rounded-md"
          ></div>
        </div>
        <div>
          <span class="inline-block mb-1">Competitor:</span>
          <div
            id="output-competitor"
            class="border-2 border-emerald-500 min-w-20 h-8 rounded-md"
          ></div>
        </div>
      </div>
      <div
        class="w-fit border text-white bg-blue-900 rounded-md py-1 px-5 cursor-pointer"
        onclick="onSubmit()"
      >
        Submit
      </div>
    </div>
  </body>
  <script>
    const queryString = window.location.search;
    const urlParams = new URLSearchParams(queryString);
    const parameterValue = urlParams.get("c");
    // console.log(parameterValue);

    let companyElArray = document.querySelectorAll(".company");

    // console.log(companyElArray);
    companyElArray.forEach(function (companyEl) {
      let companyElValue = companyEl.getAttribute("value");
      if (parameterValue === companyElValue) {
        companyEl.setAttribute("selected", true);
      }
    });
  </script>
</html>
